// Function to create a new Jira issue
void create_newjira_issue() {
    node {
        stage('JIRA') {
            def jiraURL = 'https://manasvid.atlassian.net'

            // Authenticate with Jira using Jira username and password
            withCredentials([usernamePassword(credentialsId: 'f4f6fc3b-b281-45b3-8085-b77c53e0fd69', passwordVariable: '?N4viN:9!^~/g8F', usernameVariable: 'manasvid')]) {
                def jiraUsername = 'manasvid' 
                def jiraPasswordOrToken = '?N4viN:9!^~/g8F' 

                def NewJiraIssue = [
                    fields: [
                        project: [key: 'JT'],
                        summary: 'Build Failed: Summary.',
                        description: 'Description of JIRA ticket from Jenkins',
                        issuetype: [name: 'Bug']
                    ]
                ]

                // Create the Jira issue
                response = jiraNewIssue issue: NewJiraIssue, site: jiraURL, username: jiraUsername, password: jiraPasswordOrToken

                echo response.successful.toString()
                echo response.data.toString()
            }
        }
    }
}

pipeline {
    agent any

    stages {
        stage('version') {
            steps {
                sh 'python3 --version'
            }
        }

        stage('getinfo') {
            steps {
                // Run the Python script using the Anaconda Python interpreter
                sh '/Users/manasvidhankani/opt/anaconda3/bin/python test.py'
            }
        }
    }

    post {
        failure {
            // Create Jira issue if build fails
            create_newjira_issue()
        }
    }
}
